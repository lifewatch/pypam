
<!--
 DO NOT EDIT.
 THIS FILE WAS AUTOMATICALLY GENERATED BY mkdocs-gallery.
 TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
 "examples/plot_hybrid_millidecade_bands.py"
 LINE NUMBERS ARE GIVEN BELOW.
-->

!!! note

    Click [here](#download_links)
    to download the full example code


Hybrid Millidecade bands
========================

This script is an example to compute hybrid millidecade bands, save them as netCDF files and use them to plot

<!-- GENERATED FROM PYTHON SOURCE LINES 11-12 -->

Create the hydrophone object

<!-- GENERATED FROM PYTHON SOURCE LINES 12-23 -->

```{.python }
import pyhydrophone as pyhy
import pypam

# Soundtrap
model = "ST300HF"
name = "SoundTrap"
serial_number = 67416073
soundtrap = pyhy.soundtrap.SoundTrap(
    name=name, model=model, sensitivity=-172.8, serial_number=serial_number
)

```








<!-- GENERATED FROM PYTHON SOURCE LINES 24-25 -->

Set the study parameters

<!-- GENERATED FROM PYTHON SOURCE LINES 25-37 -->

```{.python }

# First, decide band to study. The top frequency should not be higher than the nyquist frequency (sampling rate/2)
band = [0, 4000]

# Then, set the nfft to double the sampling rate. If you want to pass None to your band, that is also an option, but
# then you need to know the sampling frequency to choose the nfft.
nfft = band[1] * 2  # or nfft = 8000

# Set the band to 1 minute
binsize = 60.0


```








<!-- GENERATED FROM PYTHON SOURCE LINES 38-39 -->

Declare the Acoustic Survey

<!-- GENERATED FROM PYTHON SOURCE LINES 39-60 -->

```{.python }
include_dirs = False
zipped_files = False
dc_subtract = True
asa = pypam.ASA(
    hydrophone=soundtrap,
    folder_path="../tests/test_data",
    binsize=binsize,
    nfft=nfft,
    timezone="UTC",
    include_dirs=include_dirs,
    zipped=zipped_files,
    dc_subtract=dc_subtract,
)

# Compute the hybrid millidecade bands
# You can choose 'density' or 'spectrum' as a method
milli_psd = asa.hybrid_millidecade_bands(
    db=True, method="density", band=band, percentiles=None
)
print(milli_psd["millidecade_bands"])

```




Out:
{: .mkd-glr-script-out }

```{.shell .mkd-glr-script-out-disp }

  0%|                                                                                                                                                                                                        | 0/3 [00:00<?, ?it/s]..\tests\test_data\67416073.210610033655.wav
  0%|                                                                                                                                                                                                        | 0/5 [00:00<?, ?it/s] 20%|######################################4                                                                                                                                                         | 1/5 [00:00<00:03,  1.18it/s] 40%|############################################################################8                                                                                                                   | 2/5 [00:00<00:01,  2.42it/s] 80%|#########################################################################################################################################################6                                      | 4/5 [00:01<00:00,  4.98it/s]                                                                                                                                                                                                                                   
 33%|################################################################                                                                                                                                | 1/3 [00:01<00:02,  1.20s/it]..\tests\test_data\67416073.210610034155.wav
  0%|                                                                                                                                                                                                        | 0/5 [00:00<?, ?it/s] 20%|######################################4                                                                                                                                                         | 1/5 [00:00<00:00,  8.22it/s] 60%|###################################################################################################################2                                                                            | 3/5 [00:00<00:00, 12.03it/s]100%|################################################################################################################################################################################################| 5/5 [00:00<00:00, 11.18it/s]                                                                                                                                                                                                                                   
 67%|################################################################################################################################                                                                | 2/3 [00:01<00:00,  1.26it/s]..\tests\test_data\67416073.210610034655.wav
  0%|                                                                                                                                                                                                        | 0/5 [00:00<?, ?it/s] 40%|############################################################################8                                                                                                                   | 2/5 [00:00<00:00, 17.16it/s]100%|################################################################################################################################################################################################| 5/5 [00:00<00:00, 21.92it/s]                                                                                                                                                                                                                                   
100%|################################################################################################################################################################################################| 3/3 [00:01<00:00,  1.79it/s]100%|################################################################################################################################################################################################| 3/3 [00:01<00:00,  1.51it/s]
<xarray.DataArray 'millidecade_bands' (id: 18, frequency_bins: 1400)>
array([[107.12148692, 106.35207795,  99.1527314 , ..., -44.37420226,
        -50.02876127, -53.10621923],
       [107.36452089, 106.40475592,  97.8538451 , ..., -44.85179298,
        -49.91661407, -52.66584545],
       [107.36884989, 106.82555761,  97.49484291, ..., -45.10001757,
        -50.9158965 , -52.62115782],
       ...,
       [107.39769473, 106.33787223,  93.79044492, ..., -44.63627932,
        -50.29965203, -52.77922534],
       [108.31286521, 106.93937232,  94.29078787, ..., -44.07367095,
        -49.58126669, -52.59687466],
       [ 56.61729663,  53.61831716,  12.93788447, ..., -26.27747371,
        -26.28720262, -28.90494788]])
Coordinates:
  * id               (id) int32 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17
    datetime         (id) datetime64[ns] 2021-06-10T03:36:55 ... 2021-06-10T0...
    start_sample     (id) int32 0 480000 960000 ... 1440000 1920000 2400000
    end_sample       (id) int32 480000 960000 1440000 ... 2400000 2880000
    file_path        (id) <U44 '..\\tests\\test_data\\67416073.210610033655.w...
    _start_frame     (id) int32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
  * frequency_bins   (frequency_bins) float64 0.0 1.0 2.0 ... 3.995e+03 4e+03
    lower_frequency  (frequency_bins) float64 -0.5 0.5 ... 3.99e+03 3.999e+03
    upper_frequency  (frequency_bins) float64 0.5 1.5 2.5 ... 3.999e+03 4e+03
Attributes:
    units:          uPa^2/Hz
    standard_name:  PSD

```





<!-- GENERATED FROM PYTHON SOURCE LINES 61-63 -->

Now, with the obtained hybrid millidecade bands, make some plots
We will first load some pre-computed data

<!-- GENERATED FROM PYTHON SOURCE LINES 63-87 -->

```{.python }
import xarray

milli_psd_day = xarray.open_dataset("../tests/test_data/test_day.nc")
milli_psd_day = milli_psd_day.where(milli_psd_day.frequency_bins > 10, drop=True)

# Plot the spectrum mean with the standard deviation
pypam.plots.plot_spectrum_median(
    milli_psd_day, data_var="millidecade_bands", frequency_coord="frequency_bins"
)

# Plot the SPD with percentiles
percentiles = [10, 50, 90]
spd = pypam.utils.compute_spd(
    milli_psd_day, data_var="millidecade_bands", percentiles=percentiles
)
pypam.plots.plot_spd(spd)

# Plot a summary
pypam.plots.plot_summary_dataset(
    milli_psd_day,
    data_var="millidecade_bands",
    percentiles=percentiles,
    freq_coord="frequency_bins",
)
```



<ul class="mkd-glr-horizontal">
<img alt="Millidecade bands" src="../images/mkd_glr_plot_hybrid_millidecade_bands_001.png" srcset="../images/mkd_glr_plot_hybrid_millidecade_bands_001.png", class="sphx-glr-single-img" /><img alt="Spectral Probability Density (SPD)" src="../images/mkd_glr_plot_hybrid_millidecade_bands_002.png" srcset="../images/mkd_glr_plot_hybrid_millidecade_bands_002.png", class="sphx-glr-single-img" /><img alt="plot hybrid millidecade bands" src="../images/mkd_glr_plot_hybrid_millidecade_bands_003.png" srcset="../images/mkd_glr_plot_hybrid_millidecade_bands_003.png", class="sphx-glr-single-img" />
</ul>


Out:
{: .mkd-glr-script-out }

```{.shell .mkd-glr-script-out-disp }
C:\Users\cleap\Documents\code\pypam\pypam\plots.py:349: UserWarning: FigureCanvasAgg is non-interactive, and thus cannot be shown
  plt.show()
C:\Users\cleap\Documents\code\pypam\pypam\plots.py:98: UserWarning: FigureCanvasAgg is non-interactive, and thus cannot be shown
  plt.show()
C:\Users\cleap\Documents\code\pypam\pypam\plots.py:580: UserWarning: FigureCanvasAgg is non-interactive, and thus cannot be shown
  plt.show()

```






**Total running time of the script:** ( 0 minutes  4.787 seconds)

<div id="download_links"></div>



[:fontawesome-solid-download: Download Python source code: plot_hybrid_millidecade_bands.py](./plot_hybrid_millidecade_bands.py){ .md-button .center}

[:fontawesome-solid-download: Download Jupyter notebook: plot_hybrid_millidecade_bands.ipynb](./plot_hybrid_millidecade_bands.ipynb){ .md-button .center}


[Gallery generated by mkdocs-gallery](https://smarie.github.io/mkdocs-gallery){: .mkd-glr-signature }
